require "json"
require "open-uri"

class HtmlGenerator
  attr_accessor :products, :html_start, :html_end

  def initialize
    raw_response = open("http://lcboapi.com/products").read
    parsed_response = JSON.parse(raw_response)
    @products = parsed_response["result"]

    @html_start = [
        "<!DOCTYPE html>\n",
        "<html>\n",
        "<head>\n",
        "<title></title>\n",
        "<link rel='stylesheet' type='text/css' href='style.css'/>\n",
        "</head>\n",
        "<body>\n" ]

      @html_end  = [
        "</div>\n",
        "\t</div>\n",
        "\t\t<div id='footer'>Footer</div>\n",
        "</body>\n",
        "</html>\n" ]
    end
    
    def index
      @html_start.each { |tag| puts tag}
        puts "<div id='container'>"
        puts "<div id='header'>Header</div>"
        puts "<div class='products'>"
        puts "<div class='container2'>"

    @products.each do |product| 
      if product.has_key?("image_thumb_url") && product.has_key?("id")
        puts "<div class='product_img'> "
          puts " <div class='id'> "
          puts " #{product['id']} "
          puts "</div>"
        puts " <img src='#{product["image_thumb_url"]}'> "
          puts "<div class='product_name'>"
          puts "#{product['name']}"
          puts "</div>"
        puts "</div>"
      end
    end
    puts "</div>"
    @html_end.each { |tag| puts tag }
  end

  def show(product_id)
      @html_start.each { |tag| puts tag}
        puts "<div id='container'>"
        puts "<div id='header'>Header</div>"
        puts "<div class='products'>"
        puts "<div class='container2'>"

    @products.each do |product|
      if product.fetch("id") == product_id.to_i
        product.each do |key, value|
          #puts "#{key} : #{value}"

        puts "<h2>#{product['name']}</h2>"
    # puts "<div style=float:left><img src=#{product['image_url']}></div>"
    # puts "<div class='info'><ul style='list-style: none;'><li>id: #{product['id']}</li>"
    # puts "<li>#{product['producer_name']}</li>"
    # puts "<li>#{product['primary_category']}</li>"
    # puts "<li>#{product['secondary_category']}</li>" 
    # puts "<li>#{product['origin']}</li>"
    # puts "<li>#{product['package_unit_volume_in_milliliters']} ml</li>"
    # puts "<li>#{product['package']}</li>"
    # puts "<li>$#{product['price_in_cents'].to_f/100}</li>"
    # puts "<li>#{product['serving_suggestion']}</li>"
    # puts "<li>#{product['tasting_note']}</li>"
    # puts "<li>Tags: #{product['tags']}</li></ul></div>"
    # puts "<div style=clear:both></div>"
        end
      end
    end
  end
end

